<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>&lt;undefined&gt;</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>//todo fix ui
//todo background
//todo load profile
//todo check profile file headers to validate
//todo locole
caption = 'AUTHORIZATION'
loadrot = 0
load = false  
encpw = false
OnclickEvent = 0

//TODO: Tab event
//nickname form
nameForm = instance_create(800,300,oForm)
uiFormSet(nameForm, global.userdata[?'LOGIN'])

//password form
pwForm = instance_create(800,440,oForm)
uiFormSet(pwForm, global.userdata[?'PW'])
pwForm.hidden = true

//save passw checkbox
spCb = instance_create(670,550,oCheckBox)
if global.userdata[?'SAVEPW'] &gt; 0
  {
  spCb.checked = true
  pwForm.contentDraw = '***************'
  encpw = true
  }
spCb.content = 'Save Password'
spCb.hint = 'Allow game to save your password for next launch'
spCb.font = fCube
spCb.dsc = 0.5
spCb.tsc = 0.5
with spCb {uiRescale(375)}

//auto-login checkbox
alCb = instance_create(930,550,oCheckBox)
if global.userdata[?'AUTOLOG'] &gt; 0
  alCb.checked = true
alCb.content = 'Auto Sign in'
alCb.hint = 'Allow game to load your profile automatically'
alCb.font = fCube
alCb.dsc = 0.5
alCb.tsc = 0.5
with alCb {uiRescale(375)}

//login button
bLog = instance_create(800,700,oButton)
bLog.content = 'SIGN IN'
bLog.parent = id

bNoLog = instance_create(800,900,oButton)
bNoLog.content = 'Play offline'
bNoLog.font = fCube
bNoLog.dsc = 0.5
bNoLog.tsc = 0.5
with bNoLog {uiRescale(506)}
bNoLog.parent = id

bReg = instance_create(800,1000,oButton)
bReg.content = 'Create account'
bReg.font = fCube
bReg.dsc = 0.5
bReg.tsc = 0.5
with bReg {uiRescale(506)}
bReg.parent = id

bExit = instance_create(800,1100,oButton)
bExit.content = 'EXIT'
bExit.font = fCube
bExit.dsc = 0.5
bExit.tsc = 0.5
with bExit {uiRescale(506)}
bExit.parent = id

clist = ds_list_create()
ds_list_add(clist, nameForm, pwForm, spCb, alCb, bLog, bNoLog, bReg)
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="1" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>funcLastloginWrite();
funcProfileRead()
ds_list_destroy(clist)
global.config[?'FirstLaunch'] = false
action_another_room(rMenu)
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>loadrot+= 10
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="62">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>var ok = true
//check async load errors
if async_load[? "status"] &gt; 0
  exit
if async_load[? "status"] &lt; 0
  {
  ok = false
  caption = 'CONNECTION ERROR'
  }
  
//check answer errors
if ok
  {
  var html = json_decode(async_load[? "result"])
  if html == -1
    {
    caption = 'SERVER ERROR'
    ok = false
    }
  }

//check answer fields
if ok
  if is_undefined(html[?'PNETID'])
    {
    ok = false
    caption = 'AUTH ERROR'
    }
    //todo: check another fields
  
//log 
if ok
  {
  //TODO GET FILE
  global.config[?'ProfileFile'] = nameForm.contentSaved
  global.profile[?'PNETID'] = html[?'PNETID']
  global.userdata[?'AT'] = html[?'ACCESS_TOKEN']
    
  // write login
  global.userdata[?'PNETID'] = global.profile[?'PNETID']
  global.userdata[?'LOGIN'] = nameForm.contentSaved
  global.userdata[?'PW'] = pwForm.contentSaved
  if spCb.checked
    global.userdata[?'SAVEPW'] = 1
  else
    global.userdata[?'SAVEPW'] = 0
  if alCb.checked
    global.userdata[?'AUTOLOG'] = 1
  else
    global.userdata[?'AUTOLOG'] = 0    
  instance_destroy(self,true)
  exit
  }

//error
pwForm.content = ''
pwForm.contentSaved = ''
pwForm.contentDraw = ''
encpw = false
uiSetClickable(clist, true)
load = false
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="10">
      <action>
        <libid>1</libid>
        <id>605</id>
        <kind>0</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>0</useapplyto>
        <exetype>0</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>ui onclick</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if bLog.clicked
  {
  if !encpw {
    encpw = true
    pwForm.contentSaved = sha1_string_utf8(pwForm.contentSaved)
    }
  http_get('http://sooslick.flaminggaming.ru/wl/authUser.php?login=' + nameForm.contentSaved + '&amp;passw=' + pwForm.contentSaved)
  uiSetClickable(clist, false)
  load = true
  }  
else if bNoLog.clicked
  {
  global.config[?'ProfileFile'] = 'anonymous'
  //todo change login data
  instance_destroy(self,true)
  }
else if bReg.clicked
  url_open('http://sooslick.flaminggaming.ru/reg.php')
else if bExit.clicked
  action_end_game()
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="64">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>drawTextPreset(fImpact96,c_white,1,fa_center,fa_center)
draw_text(800,100,caption)

if load
  drawLoading(loadrot)
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
